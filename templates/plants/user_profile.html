{% extends "base.html" %}
{% block title %}{{ identity.display_name|default:identity.username }} | Gardn{% endblock %}
{% block content %}
<section class="card profile-card">
  <h1>{{ identity.display_name|default:identity.username }}</h1>
  <p class="subtle"><a href="{{ identity.me_url }}" rel="me">{{ identity.me_url }}</a></p>
  {% if identity.mastodon_profile_url and identity.mastodon_profile_url != identity.me_url %}<p class="subtle"><a href="{{ identity.mastodon_profile_url }}" rel="me">{{ identity.mastodon_profile_url }}</a></p>{% endif %}
  {% if identity.photo_url %}
    <p><img class="profile-photo" src="{{ identity.photo_url }}" alt="Photo for {{ identity.display_name|default:identity.username }}" width="96" height="96" loading="lazy"></p>
  {% endif %}
  {% if identity.bio %}
    <div class="bio">{{ identity.bio|safe }}</div>
  {% endif %}
  <img class="main-plant" src="/u/{{ identity.username }}/plant.svg" alt="Plant for {{ identity.username }}" width="240" height="192">
  <div id="pick-state">
    {% include "picks/_pick_button.html" with picked_identity=identity viewer=viewer has_picked=has_picked pick_count=pick_count %}
  </div>
</section>

<section class="card">
  <h2>{{ identity.display_name|default:identity.username }}'s picks ({{ picks_page.paginator.count }})</h2>
  <div class="grid garden-grid">
    {% for pick in picks_page %}
      <a class="card garden-card" href="/u/{{ pick.picked.username }}/">
        <div class="plant-frame">
          <img src="/u/{{ pick.picked.username }}/plant.svg" alt="Plant for {{ pick.picked.username }}" width="120" height="96">
        </div>
        <strong class="garden-name">{{ pick.picked.display_name|default:pick.picked.username }}</strong>
        <small class="garden-meta">{{ pick.picked.me_url|cut:"https://"|cut:"http://" }}</small>
      </a>
    {% empty %}
      <p>No picks yet.</p>
    {% endfor %}
  </div>
  {% include "plants/_pagination.html" with page=picks_page param="picks_page" extra="" %}
</section>

{% if harvest_page %}
<section class="card">
  <h2>{{ identity.display_name|default:identity.username }}'s harvests ({{ harvest_page.paginator.count }})</h2>
  <div class="grid harvest-grid">
    {% for harvest in harvest_page %}
      <div class="card harvest-card">
        <div class="harvest-card-domain subtle">{{ harvest.url|cut:"https://"|cut:"http://"|truncatechars:40 }}</div>
        <a class="harvest-card-title" href="{{ harvest.url }}" rel="noopener noreferrer" target="_blank">
          {{ harvest.title|default:harvest.url|truncatechars:80 }}
        </a>
        {% if harvest.note %}
          <p class="harvest-card-note subtle">{{ harvest.note|truncatechars:120 }}</p>
        {% endif %}
        {% with harvest.tags_list as tag_list %}
          {% if tag_list %}
            <div class="harvest-tags">
              {% for tag in tag_list %}<span class="harvest-tag">{{ tag }}</span>{% endfor %}
            </div>
          {% endif %}
        {% endwith %}
        <div class="harvest-card-footer">
          <span class="subtle harvest-card-date">{{ harvest.harvested_at|date:"M j, Y" }}</span>
        </div>
      </div>
    {% endfor %}
  </div>
  {% include "plants/_pagination.html" with page=harvest_page param="harvest_page" extra="" %}
</section>
{% endif %}
{% endblock %}
